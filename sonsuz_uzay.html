<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>SONSUZ UZAY DARBESİ - SONSUZ.AY</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAAAdklEQVRogcYyQRCAMAwD8w/8SAU60IE+8g88EAIG3E1m93iH3ZtU3a76iY+4Y48/G2KPP/7YY48/9thjjz/22GOPP/bYYY8/9thjjz/22GOPP/bYY48/9thjjz/22GOPP/bYY48/9thjjz/22GOPP/bYEwE+sR9XfWJ3eQAAAABJRU5ErkJggg==">

    <style>
        body {
            background-color: #00001a;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            touch-action: none; 
            color: #fff;
        }

        #oyunKutusu {
            position: relative;
            width: 320px;
            height: 480px;
            max-width: 95vw;
            max-height: 95vh;
            aspect-ratio: 2 / 3;
            width: min(320px, 95vw);
            height: min(480px, 95vh);
        }

        canvas {
            width: 100%;
            height: 100%;
            border: 2px solid #ff00ff; 
            background: #000;
            box-shadow: 0 0 40px rgba(255, 0, 255, 0.4);
            border-radius: 5px;
            display: block;
        }

        #skorBilgi {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #ff0;
            font-size: 16px;
            font-weight: bold;
            z-index: 10;
        }

        #bilgiMesaji {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,26,0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 20;
            border-radius: 5px;
            text-align: center;
        }

        #baslaButonu, #tekrarButonu {
            background: #0ff; 
            border: none; 
            padding: 15px 30px; 
            font-weight: bold; 
            font-size: 22px; 
            cursor: pointer; 
            box-shadow: 0 0 15px #0ff;
            border-radius: 50px;
            margin-top: 20px;
            touch-action: manipulation; 
        }
        #baslaButonu:active, #tekrarButonu:active { transform: scale(0.95); }
    </style>
</head>
<body>

    <div id="oyunKutusu">
        <canvas id="oyunAlani" width="320" height="480"></canvas>
        <div id="skorBilgi">SKOR: 0 | EN İYİ: 0 | CAN: 3</div>

        <div id="bilgiMesaji">
            <h2 style="margin-top:0; color:#ff00ff; text-shadow: 0 0 10px #ff00ff;">SONSUZ UZAY DARBESİ</h2>
            <p style="color:white; padding:0 15px;">
                Düşman uzay gemilerini vur, engellere dikkat et.<br>
                <span style="color:#0ff; font-weight:bold;">Ekranı sürükleyerek gemiyi hareket ettir!</span>
            </p>
            <button id="baslaButonu">BAŞLA</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('oyunAlani');
        const ctx = canvas.getContext('2d');
        const skorBilgiEl = document.getElementById('skorBilgi');
        const bilgiMesaji = document.getElementById('bilgiMesaji');
        const baslaButonu = document.getElementById('baslaButonu');

        let oyunAktif = false;
        let skor = 0;
        let yuksekSkor = localStorage.getItem('uzayYuksekSkor') || 0; // Local Storage'dan yükle
        let can = 3;
        let animasyonId;

        // --- Oyuncu (Gemi) Ayarları ---
        let gemi = {
            x: canvas.width / 2 - 15,
            y: canvas.height - 40,
            w: 30,
            h: 30,
            renk: '#0ff'
        };

        // --- Mermi Ayarları ---
        let mermiler = [];
        let mermiHizi = 10;
        let atesSikligi = 10; 
        let atesSayaci = 0;

        // --- Düşman ve Engeller ---
        let dusmanlar = [];
        let dusmanHizi = 2;
        let dusmanOlusumHizi = 150; 
        let dusmanSayaci = 0;
        const DUSMAN_GENISLIK = 25;
        const DUSMAN_YUKSEKLIK = 25;

        // --- Kontrol ---
        let mevcutHiz = 0; 
        
        // Mobil Kontrol
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault(); 
            mevcutHiz = 0; 
        }, { passive: false });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            
            let rect = canvas.getBoundingClientRect();
            let canvasX = e.touches[0].clientX - rect.left;
            
            let hedefX = (canvasX / rect.width) * canvas.width - gemi.w / 2;
            
            let farkX = hedefX - gemi.x;
            gemi.x += farkX * 0.2; 

        }, { passive: false });

        canvas.addEventListener('touchend', () => {
            mevcutHiz = 0;
        });

        // Mouse Kontrolü 
        let fareBasili = false;
        let hareketYonu = 0; 
        
        canvas.addEventListener('mousedown', (e) => {
            fareBasili = true;
            let rect = canvas.getBoundingClientRect();
            let relativeX = e.clientX - rect.left;
            hareketYonu = (relativeX < rect.width / 2) ? -1 : 1;
        });

        canvas.addEventListener('mouseup', () => {
            fareBasili = false;
            hareketYonu = 0;
        });
        
        // --- Oyun Fonksiyonları ---

        function oyunuBaslat() {
            bilgiMesaji.style.display = 'none';
            oyunAktif = true;
            skor = 0;
            can = 3;
            gemi.x = canvas.width / 2 - gemi.w / 2;
            mermiler = [];
            dusmanlar = [];
            
            // Zorluk ayarlarını sıfırla
            dusmanOlusumHizi = 150; 
            dusmanHizi = 2;
            
            if (animasyonId) cancelAnimationFrame(animasyonId);
            loop();
        }

        function atesEt() {
            if (oyunAktif && atesSayaci >= atesSikligi) {
                mermiler.push({
                    x: gemi.x + gemi.w / 2 - 2,
                    y: gemi.y,
                    w: 4,
                    h: 8,
                    renk: '#ff0'
                });
                atesSayaci = 0;
            }
        }

        // --- DÜŞMAN ÜRETİMİ (GÜNCELLENMİŞ: RASTGELE ZORLUK İLE) ---
        function dusmanUret() {
            if (oyunAktif && dusmanSayaci >= dusmanOlusumHizi) {
                
                const hiz = dusmanHizi + Math.random() * 1.5;
                
                // Rastgele düşman sayısı: 1, 2 veya %10 ihtimalle 4
                let dusmanSayisi;
                if (Math.random() < 0.1) {
                    dusmanSayisi = 4; // Nadiren 4'lü zorluk salvosu
                } else {
                    dusmanSayisi = Math.floor(Math.random() * 3) + 1; // 1, 2 veya 3
                }
                
                const baslangicY = -50; 
                
                // İlk düşmanın X pozisyonunu belirle
                // Boşluk bırakmak için maksimum genişliği ayarla
                const maxGrupGenisligi = dusmanSayisi * DUSMAN_GENISLIK + (dusmanSayisi - 1) * (Math.random() * 20 + 10);
                let mevcutX = Math.random() * (canvas.width - maxGrupGenisligi); 

                for (let i = 0; i < dusmanSayisi; i++) {
                    
                    // Rastgele düşey ofset (Kademeli ve rastgele düşüş)
                    const ofsetY = Math.random() * 30 * (i * 0.5); 
                    
                    // Rastgele yatay aralık (10 ile 40 arasında)
                    const aralikX = Math.random() * 30 + 10; 
                    
                    // Düşmanı ekle
                    dusmanlar.push({
                        x: mevcutX,
                        y: baslangicY - ofsetY, 
                        w: DUSMAN_GENISLIK,
                        h: DUSMAN_YUKSEKLIK,
                        hiz: hiz,
                        renk: '#f00' 
                    });
                    
                    // Bir sonraki düşmanın X pozisyonunu güncelle
                    mevcutX += DUSMAN_GENISLIK + aralikX;

                    // Eğer canvas'ın dışına çıkıyorsa döngüyü durdur (Güvenlik)
                    if (mevcutX > canvas.width - DUSMAN_GENISLIK) break;
                }
                
                dusmanSayaci = 0;
                
                // Zorluğu yavaşça artır
                if (dusmanOlusumHizi > 30) dusmanOlusumHizi -= 1; 
                if (dusmanHizi < 5) dusmanHizi += 0.005; 
            }
        }
        // --- DÜŞMAN ÜRETİMİ SONU ---

        function guncelle() {
            if (!oyunAktif) return;

            // Sayaçları artır
            atesSayaci++;
            dusmanSayaci++;

            // 1. Mouse Kontrolü ile hareket
            if (fareBasili) {
                 gemi.x += hareketYonu * 5; 
            }
            
            // 2. Gemi Sınır Kontrolü
            gemi.x = Math.max(0, Math.min(gemi.x, canvas.width - gemi.w));
            
            // 3. Ateş et
            atesEt();

            // 4. Düşman Üret ve Hareket Ettir
            dusmanUret();
            
            // Düşman hareketini güncelle
            dusmanlar.forEach((d, i) => {
                d.y += d.hiz;
                // Düşman alttan çıkarsa can kaybet
                if (d.y > canvas.height) {
                    dusmanlar.splice(i, 1);
                    can--;
                }
            });
            
            // 5. Mermi Hareketi
            mermiler.forEach((m, i) => {
                m.y -= mermiHizi;
                if (m.y < 0) {
                    mermiler.splice(i, 1);
                }
            });

            // 6. Çarpışma Kontrolü
            
            // Mermi ve Düşman Çarpışması
            mermiler.forEach((m, mIdx) => {
                dusmanlar.forEach((d, dIdx) => {
                    if (m.x < d.x + d.w && m.x + m.w > d.x && m.y < d.y + d.h && m.y + m.h > d.y) {
                        // Çarpışma oldu!
                        mermiler.splice(mIdx, 1);
                        dusmanlar.splice(dIdx, 1);
                        skor += 10;
                    }
                });
            });

            // Gemi ve Düşman Çarpışması
            let gemiVuruldu = false;
            dusmanlar.forEach((d, dIdx) => {
                if (gemi.x < d.x + d.w && gemi.x + gemi.w > d.x && gemi.y < d.y + d.h && gemi.y + gemi.h > d.y) {
                    // Çarpışma oldu!
                    dusmanlar.splice(dIdx, 1);
                    can--;
                    gemiVuruldu = true;
                }
            });
            
            // 7. Skor ve Can Güncelleme
            skorBilgiEl.innerText = `SKOR: ${skor} | EN İYİ: ${yuksekSkor} | CAN: ${can}`;

            if (can <= 0) {
                oyunBitti();
                return; // Önemli: Oyun bittiyse animasyon döngüsünü durdurmak için döngüden çık
            }
        }

        function cizim() {
            // Arka planı temizle
            ctx.fillStyle = '#00001a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Yıldızlar (Basit hareketli arka plan)
            for (let i = 0; i < 50; i++) {
                ctx.fillStyle = '#fff';
                ctx.fillRect(i * 10 % canvas.width, (i * 15 + skor * 0.1) % canvas.height, 1, 1);
            }
            
            // Düşmanları Çiz
            ctx.fillStyle = '#f00';
            ctx.shadowBlur = 10;
            ctx.shadowColor = '#f00';
            dusmanlar.forEach(d => {
                ctx.fillRect(d.x, d.y, d.w, d.h);
            });

            // Mermileri Çiz
            ctx.fillStyle = '#ff0';
            ctx.shadowBlur = 10;
            ctx.shadowColor = '#ff0';
            mermiler.forEach(m => {
                ctx.fillRect(m.x, m.y, m.w, m.h);
            });

            // Gemiyi Çiz
            ctx.fillStyle = gemi.renk;
            ctx.shadowBlur = 15;
            ctx.shadowColor = gemi.renk;
            ctx.fillRect(gemi.x, gemi.y, gemi.w, gemi.h);
            
            ctx.shadowBlur = 0;
        }

        function loop() {
            if (!oyunAktif) return; // Oyun aktif değilse döngüyü durdur (Donma hatası çözüldü)
            
            guncelle();
            cizim();
            animasyonId = requestAnimationFrame(loop);
        }

        function oyunBitti() {
            oyunAktif = false;
            
            // Yüksek skoru kaydet
            if (skor > yuksekSkor) {
                yuksekSkor = skor;
                localStorage.setItem('uzayYuksekSkor', yuksekSkor);
            }
            
            bilgiMesaji.style.display = 'flex';
            bilgiMesaji.innerHTML = `
                <h2 style="color:red; margin-top:0; text-shadow:0 0 10px red;">OYUN BİTTİ!</h2>
                <p style="font-size:24px; color:white;">Son Skorun: ${skor}</p>
                <p style="font-size:18px; color:#ff0;">EN İYİ SKOR: ${yuksekSkor}</p>
                <button id="tekrarButonu">TEKRAR DENE</button>
            `;
            
            // Tekrar Dene Butonuna güncel CSS ayarlarını ekle
            const tekrarBtn = document.getElementById('tekrarButonu');
            tekrarBtn.style.cssText = baslaButonu.style.cssText; // Stili kopyala
            
            tekrarBtn.addEventListener('click', oyunuBaslat);
            tekrarBtn.addEventListener('touchstart', function(e){
                e.stopPropagation(); e.preventDefault(); oyunuBaslat();
            });
        }
        
        // Skor bilgisini başlangıçta güncelle
        skorBilgiEl.innerText = `SKOR: 0 | EN İYİ: ${yuksekSkor} | CAN: 3`;

        baslaButonu.addEventListener('click', oyunuBaslat);
        baslaButonu.addEventListener('touchstart', function(e) {
            e.stopPropagation(); 
            e.preventDefault(); 
            oyunuBaslat();
        });

        cizim(); // Başlangıç ekranını çiz
    </script>
</body>
</html>
